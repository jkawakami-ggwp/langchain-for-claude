#!/usr/bin/env sh

# Dockerã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
if ! docker-compose ps | grep -q "app.*Up"; then
  echo "âš ï¸  Dockerã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“ã€‚èµ·å‹•ã—ã¦ã‹ã‚‰å†åº¦ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚"
  echo "å®Ÿè¡Œ: docker-compose up -d"
  exit 1
fi

echo "ğŸ” Running linter..."
docker-compose exec -T app pnpm lint || {
  echo "âŒ ãƒªãƒ³ã‚¿ãƒ¼ã‚¨ãƒ©ãƒ¼: ã‚³ãƒ¼ãƒ‰ã«å•é¡ŒãŒã‚ã‚Šã¾ã™"
  echo "ä¿®æ­£ã™ã‚‹ã«ã¯: pnpm lint --fix ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"
  exit 1
}

echo "âœ¨ Running formatter check..."
docker-compose exec -T app npx prettier --check "src/**/*.{ts,js,json}" || {
  echo "âŒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼: ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“"
  echo "ä¿®æ­£ã™ã‚‹ã«ã¯: pnpm format ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„"
  exit 1
}

echo "ğŸ§ª Running tests..."
docker-compose exec -T app pnpm test --passWithNoTests || {
  echo "âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ"
  echo "ä¿®æ­£ã™ã‚‹ã«ã¯: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€å•é¡Œã‚’ä¿®æ­£ã—ã¦ãã ã•ã„"
  exit 1
}

echo "âœ… All checks passed!"
